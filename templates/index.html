<!doctype html>


<head>
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/main.css') }}">
</head>

<body onload="javascript: reload()">
<div id="main">
<a href="https://firmware.ardupilot.org/">
<div id="logo">
</div>
</a>
  
    <div id="menu">
        <title>ArduPilot Custom Firmware Builder</title>
        <h2>ArduPilot Custom Firmware Builder</h2>
        <br><b>This site is EXPERIMENTAL</b>


        <p>Please select the required options for the custom firmware build.</p>

        <form action="/generate" method="post">
            <label for="vehicle">Choose a vehicle:</label>
            <select name="vehicle">
                {% for vehicle in get_vehicles()[0] %}
                    {% if vehicle == get_vehicles()[1] %}
                        <option value="{{vehicle}}" selected>{{vehicle}}</option>
                    {% else %}
                        <option value="{{vehicle}}">{{vehicle}}</option>
                    {% endif %}
                {% endfor %}
            </select>
            <br><br>
            <label for="board">Choose a board:</label>
            <select name="board">
                {% for board in get_boards()[0] %}
                    {% if board == get_boards()[1] %}
                        <option value="{{board}}" selected>{{board}}</option>
                    {% else %}
                        <option value="{{board}}">{{board}}</option>
                    {% endif %}
                {% endfor %}
            </select>
            <br><br>
            {% for (label,define,text,default) in get_build_options() %}
                {% if default == '0' %}
                    <input type="checkbox" name="{{label}}" value="define {{define}} 1">
                    <input type="hidden" name="{{label}}" value="define {{define}} 0"> {{text}}
                {% else %}
                    <input type="checkbox" name="{{label}}" value="define {{define}} 1" checked>
                    <input type="hidden" name="{{label}}" value="define {{define}} 0"> {{text}}
                {% endif %}
            <br>
            {% endfor %}
            <br>
            <input type="submit" value="Generate" method="post">
        </form>
    </div>
<hr>
    <div id="build_status"></div>
<br />
    <script>
      function reload() {
            var output = document.getElementById('build_status');
            var xhr = new XMLHttpRequest();
            xhr.open('GET', "/builds/status.html");

            // disable cache, thanks to: https://stackoverflow.com/questions/22356025/force-cache-control-no-cache-in-chrome-via-xmlhttprequest-on-f5-reload
            xhr.setRequestHeader("Cache-Control", "no-cache, no-store, max-age=0");
            xhr.setRequestHeader("Expires", "Tue, 01 Jan 1980 1:00:00 GMT");
            xhr.setRequestHeader("Pragma", "no-cache");

            xhr.onload = function() {
                if (xhr.status == 200) {
                    output.innerHTML = xhr.responseText;
                }
                setTimeout(reload,5000)
            }
            xhr.send();
      }
    </script>
</body>

<hr>
<footer>Created by Will Piper, <a href=https://github.com/ArduPilot/CustomBuild>Source Code<a>.</footer>
