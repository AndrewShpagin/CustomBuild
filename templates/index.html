<!doctype html>

<body onload="javascript: reload()">
    <div id="menu">
        <title>ArduPilot Custom Firmware Builder</title>
        <h1>ArduPilot Custom Firmware Builder (EXPERIMENTAL)</h1>


        <p>Please select the required options for the reduced firmware build.</p>

        <form action="/generate" method="post">
            <label for="vehicle">Choose a vehicle:</label>
            <select name="vehicle">
                {% for vehicle in get_vehicles() %}
                <option value="{{vehicle}}">{{vehicle}}</option>
                {% endfor %}
            </select>
            <br><br>
            <label for="board">Choose a board:</label>
            <select name="board">
                {% for board in get_boards() %}
                <option value="{{board}}">{{board}}</option>
                {% endfor %}
            </select>
            <br><br>
            {% for (label,define,text) in get_build_options() %}
            <input type="checkbox" name="{{label}}" value="define {{define}} 1">
            <input type="hidden" name="{{label}}" value="define {{define}} 0"> {{text}}
            <br>
            {% endfor %}
            <br>
            <input type="submit" value="Generate" method="post">
        </form>
    </div>
<hr>
    <div id="build_status"></div>
<br />
    <script>
      function reload() {
            var output = document.getElementById('build_status');
            var xhr = new XMLHttpRequest();
            xhr.open('GET', "/builds/status.html");

            // disable cache, thanks to: https://stackoverflow.com/questions/22356025/force-cache-control-no-cache-in-chrome-via-xmlhttprequest-on-f5-reload
            xhr.setRequestHeader("Cache-Control", "no-cache, no-store, max-age=0");
            xhr.setRequestHeader("Expires", "Tue, 01 Jan 1980 1:00:00 GMT");
            xhr.setRequestHeader("Pragma", "no-cache");

            xhr.onload = function() {
                if (xhr.status == 200) {
                    output.innerHTML = xhr.responseText;
                }
                setTimeout(reload,5000)
            }
            xhr.send();
      }
    </script>
</body>

<hr>
<footer>Created by Will Piper, <a href=https://github.com/ArduPilot/CustomBuild>Source Code<a>.</footer>
